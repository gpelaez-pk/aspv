<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Cucumber Test Generator</title>
    </head>

    <body>
        <h1>Cucumber Test Generator</h1>
            URL: <input type="text" id="TargetURL"><br>
            Client ID: <input type="text" id="ClientID"><br>
            Client Secret: <input type = "text" id="ClientSecret">
        <br>
        <br>
        <table>
            <tr>
                <th>Test</th>
                <th>Include</th>
            </tr>
            <tr>
                <td>Verify API Key</td>
                <td><input id="VerifyAPIKey" type="checkbox"></td>
            </tr>
            <tr>
                <td>Authorize API Key</td>
                <td><input id="AuthorizeAPIKey" type="checkbox"></td>
            </tr>
            <tr>
                <td>Verify Access Token API Key</td>
                <td><input id="VerifyAccessToken" type="checkbox"></td>
            </tr>
            <tr>
                <td>Verify OAuth Scope API Key</td>
                <td><input id="VerifyOAuthScope" type="checkbox"></td>
            </tr>
            <tr>
                <td>Verify SQL Protection API Key</td>
                <td><input id="VerifySQLProtection" type="checkbox"></td>
            </tr>
            <tr>
                <td>Verify API Key Logging</td>
                <td><input id="VerifyAPIKeyLogging" type="checkbox"></td>
            </tr>
        </table>
        <br>

        <button name="GenerateTests" onclick="sendRequest()">Generate Tests</button>
        <br><br>
        <textarea id="serverResponse" rows="10" cols="50">Request Data</textarea>
        <br><br>
        <a href="/init" download="init.js">
          <button id="DownloadTests">Download Init File</button>
        </a>
        <a href="/feature" download="test.feature">
          <button id="DownloadFeature">Download Feature File</button>
        </a>
        <br><br>
        <h2>Generate Jenkinsfile Stage</h2><br>
        Folder Location: <input type="text" id="folderLocationInput"></input>
        <button id="JenkinsWindows"
                onclick="loadJenkinsWindows()">Windows</button>
        <button id="JenkinsLinux"
                onclick="loadJenkinsLinux()">Linux</button>
        <br><br>
        <textarea id="jenkinsfileTextArea" rows="20" cols="50">JenkinsfileOutput</textarea>
    </body>

    <script type="text/javascript">
      var loadJenkinsWindows = function() {
        const jenkinsfileTextArea = document.getElementById("jenkinsfileTextArea");

        jenkinsfileTextArea.value="TextWindows";
      }

      var loadJenkinsLinux = function() {
        const folderLocationInput = document.getElementById("folderLocationInput");
        const jenkinsfileTextArea = document.getElementById("jenkinsfileTextArea");
        const xhrJenkins = new XMLHttpRequest();
        xhrJenkins.open("GET",
          "http://24.252.37.21:8000/jenkins?location="+folderLocationInput.value);
        xhrJenkins.send();
        xhrJenkins.onreadystatechange = function() {
          if (xhrJenkins.readyState === xhr.DONE){
            jenkinsfileTextArea.innerHTML = xhrJenkins.responseText;
          }
        }
      };
        

      var sendRequest = function() {
      
        const xhr = new XMLHttpRequest();

        const TargetURL = document.getElementById("TargetURL");
        const ClientID = document.getElementById("ClientID");
        const ClientSecret = document.getElementById("ClientSecret");

        const VerifyAPIKey = document.getElementById("VerifyAPIKey");
        const AuthorizeAPIKey = document.getElementById("AuthorizeAPIKey");
        const VerifyAccessToken = document.getElementById("VerifyAccessToken");
        const VerifyOAuthScope = document.getElementById("VerifyOAuthScope");
        const VerifySQLProtection = document.getElementById("VerifySQLProtection");
        const VerifyAPIKeyLogging = document.getElementById("VerifyAPIKeyLogging");



        xhr.open("POST", "http://24.252.37.21:8000/generate");
        xhr.setRequestHeader("Content-Type","application/json");
        xhr.send(
          JSON.stringify({
            "tests":{
              "AuthenticateAPIKey":VerifyAPIKey.checked,
              "AuthorizeAPIKey":AuthorizeAPIKey.checked,
              "VerifyAccessToken":VerifyAccessToken.checked,
              "VerifyOAuthScope":VerifyOAuthScope.checked,
              "VerifySQLProtection":VerifySQLProtection.checked,
              "VerifyAPIKeyLogging":VerifyAPIKeyLogging.checked
            },
            "url":TargetURL.value,
            "client":{
              "id":ClientID.value,
              "secret":ClientSecret.value
            }
          })
        )
      }
      xhr.onreadystatechange = function() {     
        if (xhr.readyState === xhr.DONE) {
          const serverResponse = document.getElementById("serverResponse");
          serverResponse.innerHTML = xhr.responseText;
        };
      }
    </script>
</html>
